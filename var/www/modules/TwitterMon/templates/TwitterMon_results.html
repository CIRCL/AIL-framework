<!DOCTYPE html>
<html>

<head>
  <title>TwitterMon - Results</title>
	<link rel="icon" href="{{ url_for('static', filename='image/ail-icon.png') }}">

  <!-- Core CSS -->
	<link href="{{ url_for('static', filename='css/bootstrap4.min.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/font-awesome.min.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/dataTables.bootstrap4.min.css') }}" rel="stylesheet">

  <!-- JS -->
	<script src="{{ url_for('static', filename='js/jquery.js')}}"></script>
	<script src="{{ url_for('static', filename='js/popper.min.js')}}"></script>
	<script src="{{ url_for('static', filename='js/bootstrap4.min.js')}}"></script>
	<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js')}}"></script>
	<script src="{{ url_for('static', filename='js/dataTables.bootstrap.min.js')}}"></script>

        <script src="{{ url_for('static', filename='js/jquery.flot.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.flot.pie.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.flot.time.js') }}"></script>

	<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <style>


/* ----------------------------------------*/
/*    ICONS                                */
/* ----------------------------------------*/

i { cursor: pointer; }


/* ----------------------------------------*/
/*    TABS                                 */
/* ----------------------------------------*/

.tabs{
  position:relative;
  text-align:center;
  margin:0em;
  cursor: pointer; 
  color:#666;
  text-decoration:none;
  display:inline-block;
  text-align:center;
  border:1px solid gray;
  margin-right:.25em;
  cursor:pointer;
  padding:1em 2em;
  background-color:#eee;
  -webkit-border-radius:.5em .5em 0em 0em;
     -moz-border-radius:.5em .5em 0em 0em;
          border-radius:.5em .5em 0em 0em;
}

.tabs:hover{ background-color:#343a40;color:#fff;}
.tabs:focus{background-color:#343a40; color:#fff;}
.active-tab{background-color:#343a40; color:#fff;}

/* ----------------------------------------*/
/*    TOP BOXES                            */
/* ----------------------------------------*/


.boxNoData{
display:none;
}


.boxCollapsed{
height:11.1em;
}


.boxUnfolded{

}


/* ----------------------------------------*/
/*    NO DATA PANEL                        */
/* ----------------------------------------*/

.noDataPanel {
 position:fixed;
 top:0;left:0;bottom:0;right:0;
 margin:auto;
 width:60%;
 height:40%; 
 background:#5e696f;
 background: rgba(240,240,253,0,90);
 padding:22px 32px;
 -moz-border-radius: 8px;
 -webkit-border-radius:8px;
 border-radius:8px;
 -moz-box-shadow:0 0 18px rgba(0,0,0,0.9);
 -webkit-box-shadow:0 0 18px rgba(0,0,0,0.9);
 -box-shadow:0 0 18px rgba(0,0,0,0.9);
}

.noDataPanel >p{

 vertical-align:center;
 position:relative;
 top:40%;
 font-size:25px;
 color:white;
}

.noDataPanel >a{
 color:#51eff7;
}

.noDataPanel >p >i{
 color:white;
 background-color:#5e696f;
 vertical-align:center;
}

.topImageFix {
display:block !important
}

/* ----------------------------------------*/
/*    TWITTER USER PHOTO                   */
/* ----------------------------------------*/

.img-circle{
 border-radius:50%;
 width:3em;
 margin:auto;
 display:block;
}

.img-circle2{
 border-radius:50%;
 width:3em;
}

/* ----------------------------------------*/
/*    INFERIOR PANEL FOR TWEET SEARCH      */
/* ----------------------------------------*/

.panelInf{
padding-top:20px;
background-color:#f6f9fd;
box-shadow:2px 2px 2px 2px
}


/* ----------------------------------------*/
/*    CONTAINER FOR TWEETS LIST            */
/* ----------------------------------------*/

#TweetsContainer {
	height: 1200px;
	width: 100%;
	border: solid 5px #8080804f;
	overflow: scroll;
	overflow-x: hidden;
	overflow-y: scroll;
	margin-top: 16px;
	background-color: #fff;
}


/* ----------------------------------------*/
/*    TWEETS                               */
/* ----------------------------------------*/

#TweetsContainer * {
    padding: 5px 10px;
}

/* OFFICIAL TWEET */

#SandboxRoot * {
  width:100%;
}

</style>

</head>
<body>

  {% include 'nav_bar.html' %}

	<div class="container-fluid">
		<div class="row">

			 {% include 'twittermon/menu_sidebar.html' %}

<div class="col-12 col-lg-10" id="core_content">
<!--<div class="row">-->
   <div class="col-lg-12">
       <div class="row">
           <div class="col-lg-12">
               <div id="panel-today" class="panel panel-default">
                   <div class="panel-heading">
                      <div id="page-title" class="row" style="padding:20px">
                        <strong>AVAILABLE TWITTER SEARCHES</strong>
	              </div>		
                  </div>
                  <div class="panel-body">
                    <div class="row">
                    	<div class="col-lg-7" id="searches-list-area">
                      	   <div class="sparkLineStats">
			      <div style="text-align:right">
				Refresh <i class='fa fa-spinner' onclick='retrieveSearches()'></i>
			      </div>
			      <div style="height:400px;width:100%;border:solid 2px #aecae6;overflow:scroll;overflow-x:hidden;overflow-y:scroll;padding:9px">
			         <label id="providerList" style="margin-bottom:2px">
	                         </label>
			      </div>
                          </div><!-- sparkLineStats -->
                      </div> <!-- col-lg-6 -->
                      <div id="tweets-chart-area" class="col-lg-5">
                         <!-- empty col -->
			 <div id="tweets-collected" style="text-align:center"><b>TWEETS COLLECTED</b><div>
                         <div id="flot-placeholder2" style="width:450px;height:300px;margin:0 auto"></div>
		      <div>
		 </div> <!-- row -->

              </div> <!-- panel-body -->
            </div> <!-- panel-today -->

	    <div class="noDataPanel" id="noDataPanel">
		<p style="font-size:40px;color:white"><i class="fa fa-info-circle"></i> No data to display</p>
                <p>Use the <a href="{{url_for('TwitterMon.TwitterMon_page')}}" id="nav_monitor_page"><i class="fas fa-binoculars"></i> Monitor Panel</a> to perform your first Twitter search.</p>
      	      
	    </div>


        </div> <!-- col-lg-12 -->
     <!-- </div>--> <!-- row -->
    </div><!-- col-lg-12 -->
   </div><!-- row -->
</div>
</div>

</div>

		<div class="row" style="padding:19px;height:250px">
			<div class="col-md-2 boxNoData"  id="TM-st-avgsent-cont" style="border-radius:5%;background:#343a40;padding:14px;margin:9px;box-shadow:2px 2px 2px;position:absolute;margin-left:0%;z-index:1">
				<div style="text-align:center;padding-bottom:6px;color:white">AVG SENTIMENT</div>
	                      <div  class="row" id="generalSentiment"></div>
			</div>
			<div class="col-md-2 boxNoData" id="TM-st-topusers-cont" style="border-radius:5%;background:#343a40;padding:14px;margin:9px;box-shadow:2px 2px 2px;position:absolute;margin-left:17em;z-index:1">
				<div style="text-align:center;padding-bottom:6px;color:white">TOP TWEETERS</div>
				<div  class="row" id="TM-st-topusers"></div>
			</div>
			<div class="col-md-2 boxNoData" id="TM-st-toplangs-cont" style="border-radius:5%;background:#343a40;padding:14px;margin:9px;box-shadow:2px 2px 2px;position:absolute;margin-left:34em;z-index:1">
				<div style="text-align:center;padding-bottom:6px;color:white">TOP LANGUAGES</div>
				<div  class="row" id="TM-st-toplangs"></div>
			</div>

			<div class="col-md-2 boxNoData" id="TM-st-tophasht-cont" style="border-radius:5%;background:#343a40;padding:14px;margin:9px;box-shadow:2px 2px 2px;position:absolute;margin-left:51em;z-index:1">
				<div style="text-align:center;padding-bottom:6px;color:white">TOP HASHTAGS</div>
				<div  class="row" id="TM-st-topHashT"></div>
			</div>
		</div>

	    <div id="dataRow" class="row">
		<p style="font-size: 35px;color: #add0fd;padding-left: 25%;"> CLICK <i class='fa fa-search'></i> TO SEE DETAIL</p>
		<!-- DATA ROW -->
            </div>
</div>
</div>

<script>

// ================================================================================
// ============================                 ===================================
// ============================   VARIABLES     ===================================
// ============================                 ===================================
// ================================================================================

// Colour for Tag icon

tweetTaggedOn = "#add0fd";
tweetTaggedOff = "#eaeaea";
currentSearchDisplayed = ""
currentSearchBeingLoaded = ""


// ================================================================================
// ============================                 ===================================
// ============================   LOADING       ===================================
// ============================                 ===================================
// ================================================================================



	/* ---------------------------------------------------------------------
	//
	// DOCUMENT READY
	//
	// -------------------------------------------------------------------- */
  
	$(document).ready(function(){


		// Set page for AIL
		// ----------------------------------------
	
		activePage = "page-TwitterMon"
		$("#"+activePage).addClass("active");

		$('#noDataPanel').hide();


		// Get list of searches
		// ----------------------------------------

		retrieveSearches();

	});


// ================================================================================
// ============================                 ===================================
// ============================   AUXILIARY     ===================================
// ============================   FUNCTIONS     ===================================
// ============================                 ===================================
// ================================================================================


	/* ---------------------------------------------------------------------
	//
	// LOAD TWEETS
	//
	// -------------------------------------------------------------------- */

	function loadTweets(searchname){

		currentSearchBeingLoaded = searchname;

		var tweets = jQuery(".tweet");
		var tweetN = 0;
    		var interval = setInterval(function() { 
			  var id = jQuery(tweets[tweetN]).attr('id');
                          twttr.widgets.createTweet(id, tweets[tweetN],{
                          	conversation : 'none',    // or all
                          	cards        : 'visible',  // or visible or hidden
                          	linkColor    : '#cc0000', // default is blue
                          	theme        : 'light'    // or dark
                          });

                          tweetN++; 

                          if ((tweetN >= tweets.length) || (currentSearchBeingLoaded != currentSearchDisplayed)) clearInterval(interval);
                }, 50);

	}


	/* ---------------------------------------------------------------------
	//
	// GET EMOJI FOR SCORE
	//
	// -------------------------------------------------------------------- */


	function getEmojiForScore(compound){

		sentimentImg = "&#128528;"; // Neutral

		// POSITIVES
		// ------------------------------------
		if (parseFloat(compound) >=  0.6){
			sentimentImg = "&#x1F603;";
		}else if (parseFloat(compound) >=  0.3){
			sentimentImg = "&#x1F604;";
		}else if (parseFloat(compound) >  0.05){
			sentimentImg = "&#x1F60A;";

		// NEGATIVES
		// ------------------------------------
		}else if (parseFloat(compound) <=  -0.6){
			sentimentImg = "&#x1F621;";
		}else if (parseFloat(compound) <=  -0.3){
			sentimentImg = "&#x1F620";
		}else if (parseFloat(compound) <  -0.05){
			sentimentImg = "&#x1F61F;";
		}

		return sentimentImg;
	}


	/* ---------------------------------------------------------------------
	//
	// SORT ARRAY
	//
	// - Data comes in the following structure: string(x-number)
	// -------------------------------------------------------------------- */

	function sortTweetArray(listToSort){
	
		listSorted = listToSort.sort(function(a, b){

			numAStartPos = 2 + a.indexOf("(x");
			numAEndPos = a.indexOf(")",numAStartPos);
			numAValue = a.substring(numAStartPos,numAEndPos);

			numBStartPos = 2 + b.indexOf("(x");
			numBEndPos = b.indexOf(")",numBStartPos);
			numBValue = b.substring(numBStartPos,numBEndPos);

			numA = parseInt(numAValue);
			numB = parseInt(numBValue);
			return numB-numA
		});

		return listSorted;
	}


	/* ---------------------------------------------------------------------
	//
	// GENERATE RANDOM COLOUR
	//
	// -
	// -------------------------------------------------------------------- */

	incrColourMin = 0;
	incrColourMax = 0.05;
	function getRandomColor() {

		 random = Math.random() * (incrColourMax - incrColourMin) + incrColourMin;
		 incrColourMin = random + 0.08;
		 incrColourMax = incrColourMin + 0.1;
		 if (incrColourMax > 1.0)incrColourMax=1.0;
 		 return "hsl(" + 360 * random + ",75%,40%)"


	}


	/* ---------------------------------------------------------------------
	//
	// EXTRACT NAME FROM NAME(Xn) FORMAT
	//
	// 
	// -------------------------------------------------------------------- */


	function extractName(name){
		return (name.substring(0,name.indexOf("(x")));

	}


	/* ---------------------------------------------------------------------
	//
	// EXTRACT NUMBER OF APPEARANCES (Xn) FORMAT
	//
	// 
	// -------------------------------------------------------------------- */


	function extractNumber(name){
		return (name.substring(name.indexOf("(x")+2,name.length-1));

	}

// ================================================================================
// ============================                 ===================================
// ============================      CHARTS     ===================================
// ============================    STATISTICS   ===================================
// ============================                 ===================================
// ================================================================================


   /* ---------------------------------------------------------------------
   //
   //                 --- NUMBER OF TWEETS GRAPH ---
   //
   // -------------------------------------------------------------------- */


	dataSet = [];

	optionsTNumber = {
    		series: {
	          pie: {
	             show: true,
        	     innerRadius: 0.5,
	             label: {
	                show: true
        	     }
	         }
	       }
 	};



   /* ---------------------------------------------------------------------
   //
   // RETRIEVE DATA FOR STATISTICS
   //
   // -------------------------------------------------------------------- */

   searchListSet = [];
   sentCompound = 0;
   searchesProcessed = 0;
   totalTweets = 0;	
   usersAPP = {};
   langsAPP = {};
   hashAPP = {};

   function retrieveDataForStatistics(){

	numSearches = 0;
	sentCompound = 0;
	searchesProcessed = 0;
	searchNamesProcessed = 0;
	totalTweets = 0;
	Object.keys(usersAPP).forEach(k=>delete usersAPP[k]);
	Object.keys(langsAPP).forEach(k=>delete langsAPP[k]);
	Object.keys(hashAPP).forEach(k=>delete hashAPP[k]);


	// LOOP THROUGH SEARCHES
	// -------------------------------------

	for(i=0; i< searchListSet.length; i++){

		searchname = searchListSet[i];


		// LOOP THROUGH SEARCHES DATA
		// -------------------------------------
		// - Looking for hashtags

		(function(searchname){
		$.get("{{ url_for('TwitterMon.get_twitter_search_general_data') }}",{searchname}, function(data){

			// HASHTAGS

			var arHashtags = data.hashtags.split(';');
			for (hn = 0; hn<arHashtags.length;hn++){
				hashName = arHashtags[hn].substring(0,arHashtags[hn].indexOf("(x"));

				numAStartPos = 2 + arHashtags[hn].indexOf("(x");
				numAEndPos = arHashtags[hn].indexOf(")",numAStartPos);
				numAValue = arHashtags[hn].substring(numAStartPos,numAEndPos);

				hashAppearances = parseInt(numAValue);

				if (!(hashName in hashAPP)){
					hashAPP[hashName] = hashAppearances;
				}else{
					hashAPP[hashName] = hashName[hashName] + hashAppearances;
				}
			}

			searchNamesProcessed += 1;
			if (searchNamesProcessed == searchListSet.length) calculateSearchesStatistics();
		});
		})(searchname);


		// LOOP THROUGH TWEETS
		// -------------------------------------

		(function(searchname){
		$.get("{{ url_for('TwitterMon.get_tweets_from_twitter_search') }}",{searchname}, function(data){

			jsonData = JSON.parse(data);


			for (j=0; j<jsonData.length; j++){
	
				totalTweets += 1;

				// SENTIMENT
				// ----------------
				sentCompound += jsonData[j].compound;

				// USERS
				// ----------------
				currUser = jsonData[j].user;
				if (!(currUser in usersAPP)){
					usersAPP[currUser] = 1;
				}else{
					usersAPP[currUser] = usersAPP[currUser] + 1;
				}


				// LANGUAGES
				// ----------------
				currLang = jsonData[j].lang;
				if (!(currLang in langsAPP)){
					langsAPP[currLang] = 1;
				}else{
					langsAPP[currLang] = langsAPP[currLang] + 1;
				}
			}
			searchesProcessed += 1;
			if (searchesProcessed == searchListSet.length) calculateTweetStatistics();
		});
		})(searchname);
	}

	
   }


   /* ---------------------------------------------------------------------
   //
   // CALCULATE SEARCHES STATISTICS
   //
   // -------------------------------------------------------------------- */

  function calculateSearchesStatistics(){

	// HASHTAGS
	// -------------------------------------

	hashTSorted = [];
	count = 0;
	for (keyhash in hashAPP){
		hashTSorted[count] = {key:keyhash,val:hashAPP[keyhash]};
		if ((keyhash) != "") count+=1;
	}

	// SORT
	//
	if (count == 0){
		hashTSorted[0] = "No Hashtags";
	}else{
	
		hashTSorted = hashTSorted.sort(function(a,b){
			if (a.val > b.val) return -1;
			if (a.val < b.val) return 1;
			return 0;
		});
	}


	// CREATE HTML
	//

	hashData = '<div style="font-size:95%;padding-left:7%;padding-bottom:14px;padding-top:14px"><a href="https://twitter.com/hashtag/'+hashTSorted[0].key.substring(1,hashTSorted[0].key.length)+'" style="color:white">'+hashTSorted[0].key+'</a></div>';
	hashData += "<div id='accordion-TopHashT' style='width:100%'>";
	hashData += "<div>";
	hashData += "<button class='btn btn-link' data-toggle='collapse' data-target='#collapse-TopHashT' onclick='toggle_TopBox(\"TM-st-tophasht-cont\",\"toggle\")' aria-expanded='true' aria-controls='collapseText' style='position:absolute;bottom:0;right:0'>";
	hashData += "<i class='fa fa-info-circle' style='color:#fff;font-size:2em'></i>";
	hashData += "</button>";
	hashData += "<div id='heading-TopHashT' style='padding-top:17%''>";
	hashData += "</div>"; //card-header
	hashData += "<div id='collapse-TopHashT' class='collapse hide' aria-labelledby='heading-TopHashT' data-parent='#accordion-TopHashT'>";
	hashData += "<div class='card-body'>";				
	hashData += "<p style='padding-left:0px;font-size:80%;color:white !important'>";
	for (i=0;(i<hashTSorted.length && i<5);i++){
		hashData += "<a href='https://twitter.com/hashtag/"+hashTSorted[i].key.substring(1,hashTSorted[i].key.length)+"'>" + hashTSorted[i].key + "</a> ("+hashTSorted[i].val+")<br>";
	}
	hashData += "</p>";
	hashData += "</div>"; //card-body
	hashData += "</div>"; //collapseText
	hashData += "</div>"; //card
	hashData += "</div>"; //accordion

	$('#TM-st-topHashT').html(hashData);

  }


   /* ---------------------------------------------------------------------
   //
   // CALCULATE TWEETS STATISTICS
   //
   // -------------------------------------------------------------------- */


   function calculateTweetStatistics(){

	// SENTIMENT
	// -------------------------------------

	avgSentCompound = sentCompound/totalTweets;

	sentData = '<div style="text-align:center;font-size:50px;">'+getEmojiForScore(avgSentCompound)+'</div>';
	sentData += "<div id='accordion-AvgSent' style='width:100%'>";
	sentData += "<div>";
	sentData += "<button class='btn btn-link' data-toggle='collapse' data-target='#collapse-AvgSent' onclick='toggle_TopBox(\"TM-st-avgsent-cont\",\"toggle\")' aria-expanded='true' aria-controls='collapseText' style='position:absolute;bottom:0;right:0'>";
	sentData += "<i class='fa fa-info-circle' style='color:#fff;font-size:2em'></i>";
	sentData += "</button>";
	sentData += "<div id='heading-AvgSent'>";
	sentData += "</div>"; //card-header
	sentData += "<div id='collapse-AvgSent' class='collapse hide' aria-labelledby='heading-AvgSent' data-parent='#accordion-AvgSent'>";
	sentData += "<div class='card-body'>";	
	sentData += "<p style='text-align:center;color:white !important'>AVG: " + (avgSentCompound).toFixed(3) + "</p>";
	sentData += "<p style='padding-left:2px;color:white !important'>";
	sentData += "&#x1F621; NEG: <= -0.6 </br>";
	sentData += "&#x1F620 NEG: <= -0.3 </br>";
	sentData += "&#x1F61F; NEG: < -0.05 </br>";
	sentData += "&#128528; NEU: >-0.05 <0.05 </br>";
	sentData += "&#x1F60A; POS: >0.05 </br>";
	sentData += "&#x1F604; POS: >= 0.3 </br>";
	sentData += "&#x1F603; POS: >= 0.6 </br>";
	sentData += "</p>";
	sentData += "</div>"; //card-body
	sentData += "</div>"; //collapseText
	sentData += "</div>"; //card
	sentData += "</div>"; //accordion

	$('#generalSentiment').html("");
	$('#generalSentiment').append(sentData);


	// USERS
	// -------------------------------------

	usersSorted = [];
	count = 0;
	for (keyuser in usersAPP){
		usersSorted[count] = {key:keyuser,val:usersAPP[keyuser]};
		count+=1;
	}

	// SORT
	//

	usersSorted = usersSorted.sort(function(a,b){
		if (a.val > b.val) return -1;
		if (a.val < b.val) return 1;
		return 0;
	});

	// CREATE HTML
	// 

	usersData = '<div><img src="https://twitter.com/'+usersSorted[0].key+'/profile_image?size=original" class="img-circle" alt="'+usersSorted[0].key+'"></div>';
	usersData += '<p style="text-align:center"><a href="https://twitter.com/'+usersSorted[0].key+'">'+usersSorted[0].key+'</a></p>';
	usersData += "<div id='accordion-TopUsers' style='width:100%'>";
	usersData += "<div>";
	usersData += "<button class='btn btn-link' data-toggle='collapse' data-target='#collapse-TopUsers' onclick='toggle_TopBox(\"TM-st-topusers-cont\",\"toggle\")' aria-expanded='true' aria-controls='collapseText' style='position:absolute;bottom:0;right:0'>";
	usersData += "<i class='fa fa-info-circle' style='color:#fff;font-size:2em'></i>";
	usersData += "</button>";
	usersData += "<div id='heading-TopUsers'>";
	usersData += "</div>"; //card-header
	usersData += "<div id='collapse-TopUsers' class='collapse hide' aria-labelledby='heading-TopUsers' data-parent='#accordion-TopUsers'>";
	usersData += "<div class='card-body'>";				
	usersData += "<p style='padding-left:14px;color:white !important'>";
	for (i=0;(i<usersSorted.length && i<5);i++){
		usersData += "<a href='https://twitter.com/"+usersSorted[i].key+"'>"+ usersSorted[i].key + "</a> ("+usersSorted[i].val+")<br>";
	}
	usersData += "</p>";
	usersData += "</div>"; //card-body
	usersData += "</div>"; //collapseText
	usersData += "</div>"; //card
	usersData += "</div>"; //accordion

	$('#TM-st-topusers').html(usersData);


	// LANGUAGES
	// -------------------------------------

	langsSorted = [];
	count = 0;
	for (keyLang in langsAPP){
		langsSorted[count] = {key:keyLang,val:langsAPP[keyLang]};
		count+=1;
	}

	// SORT
	//

	langsSorted = langsSorted.sort(function(a,b){
		if (a.val > b.val) return -1;
		if (a.val < b.val) return 1;
		return 0;
	});

	// CREATE HTML
	//

	langsData = '<div style="font-size:35px;padding-left:40%;padding-bottom:14px;color:white">'+langsSorted[0].key+'</div>';
	langsData += "<div id='accordion-TopLangs' style='width:100%'>";
	langsData += "<div>";
	langsData += "<button class='btn btn-link' data-toggle='collapse' data-target='#collapse-TopLangs' onclick='toggle_TopBox(\"TM-st-toplangs-cont\",\"toggle\")' aria-expanded='true' aria-controls='collapseText' style='position:absolute;bottom:0;right:0'>";
	langsData += "<i class='fa fa-info-circle' style='color:#fff;font-size:2em'></i>";
	langsData += "</button>";
	langsData += "<div id='heading-TopLangs' style='padding-top:10%'>";
	langsData += "</div>"; //card-header
	langsData += "<div id='collapse-TopLangs' class='collapse hide' aria-labelledby='heading-TopLangs' data-parent='#accordion-TopLangs'>";
	langsData += "<div class='card-body'>";				
	langsData += "<p style='padding-left:14px;color:white !important'>";
	for (i=0;(i<langsSorted.length && i<5);i++){
		langsData += langsSorted[i].key  + "("+langsSorted[i].val+")<br>";
	}
	langsData += "</p>";
	langsData += "</div>"; //card-body
	langsData += "</div>"; //collapseText
	langsData += "</div>"; //card
	langsData += "</div>"; //accordion

	$('#TM-st-toplangs').html(langsData);

   }

// ================================================================================
// ============================                 ===================================
// ============================      UI         ===================================
// ============================   MANAGEMENT    ===================================
// ============================                 ===================================
// ================================================================================

   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- TOGGLE SIDEBAR ---
   //
   // -------------------------------------------------------------------- */

	function toggle_sidebar(){
		
		if($('#nav_menu').is(':visible')){
			$('#nav_menu').hide();
			$('#side_menu').removeClass('border-right');
			$('#side_menu').removeClass('col-lg-2');
			$('#core_content').removeClass('col-lg-10');
		}else{
			$('#nav_menu').show();
			$('#side_menu').addClass('border-right');
			$('#side_menu').addClass('col-lg-2');
			$('#core_content').addClass('col-lg-10');
		}
	}


   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- TOP COLLAPSING BOX ---
   //
   // -------------------------------------------------------------------- */


	function toggle_TopBox(boxToModify,action){

		if (action == "hide"){
			$('#'+boxToModify).removeClass('boxCollapsed');
			$('#'+boxToModify).removeClass('boxUnfolded');
			$('#'+boxToModify).addClass('boxNoData');
		}else if (action == "show"){
			$('#'+boxToModify).addClass('boxCollapsed');
			$('#'+boxToModify).removeClass('boxNoData');
			$('#'+boxToModify).removeClass('boxUnfolded');
		}else{
			if($('#'+boxToModify).hasClass('boxCollapsed')){
				$('#'+boxToModify).removeClass('boxCollapsed');
				$('#'+boxToModify).addClass('boxUnfolded');
			}else{
				$('#'+boxToModify).removeClass('boxUnfolded');
				$('#'+boxToModify).addClass('boxCollapsed');
			}

		}

	}


   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- FILTER TWEETS BASED ON SEARCH ---
   //
   // -------------------------------------------------------------------- */

	function filterTweets(searchbox){

		  var matcher = new RegExp($(searchbox).val(), 'gi');
		  $(".connect-cat").show().not(function(){
			textFound = matcher.test($(this).find('.twtText').text());
			tagged = true;
			if (document.getElementById('tagsFilter').getAttribute('tagged') == "true"){
				tagged = ($(this).find('.fa-tag').attr('tagged') == "true")
			}
			return (textFound && tagged)
		  }).hide();
	}


	/* ---------------------------------------------------------------------
	//
	// UI MANAGEMENT --- FILTER TAGGED TWEETS---
	//
	// -------------------------------------------------------------------- */

	function filterTaggedTweets(){

		  if (document.getElementById('tagsFilter').getAttribute('tagged') == "true"){
			newTagState = "false";
			document.getElementById('tagsFilter').style.color = tweetTaggedOff;
		  }else{
			$('#TM-filterTweets').val("");
			newTagState = "true";
			document.getElementById('tagsFilter').style.color = tweetTaggedOn;
		  }
   		  document.getElementById('tagsFilter').setAttribute('tagged',newTagState);

		  $(".connect-cat").show().not(function(){
			if (newTagState == "true"){
				return ($(this).find('.fa-tag').attr('tagged') == newTagState);
			}else{
				return true;
			}

		  }).hide();
	}



   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- NO DATA DISPLAYED ---
   //
   // -------------------------------------------------------------------- */


	function setUIForNoData(){

		//console.log("setUIForNoData");

		// SHOW  NO DATA PANEL
		// -------------------------------------

		$('#noDataPanel').show();


		// HIDE SEARCHES LIST AREA
		// -------------------------------------

		$('#searches-list-area').hide();


		// HIDE TITLE
		// -------------------------------------

		$('#page-title').hide();
		$('#tweets-collected').hide();


		// HIDE TWEETS CHART AREA
		// -------------------------------------

		$('#flot-placeholder2').hide();


		// HIDE TWEET DETAIL AREA
		// -------------------------------------

		$('#dataRow').hide();


		// HIDE TOP PANELS
		// -------------------------------------

		toggle_TopBox("TM-st-avgsent-cont","hide");
		toggle_TopBox("TM-st-topusers-cont","hide");
		$('#TM-st-topusers').removeClass('topImageFix');
		$('#generalSentiment').removeClass('topImageFix');
		toggle_TopBox("TM-st-toplangs-cont","hide");
		toggle_TopBox("TM-st-tophasht-cont","hide");

	}



   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- DISPLAY DATA ---
   //
   // -------------------------------------------------------------------- */


	function setUIForData(){

		//console.log("setUIForData");

		// HIDE NO DATA PANEL
		// -------------------------------------

      	        $('#noDataPanel').hide();


		// SHOW SEARCHES LIST AREA
		// -------------------------------------

		$('#searches-list-area').show();


		// SHOW TITLE
		// -------------------------------------

		$('#page-title').show();
		$('#tweets-collected').show();


		// SHOW TWEETS CHART AREA
		// -------------------------------------

		$('#flot-placeholder2').show();


		// SHOW TWEET DETAIL AREA
		// -------------------------------------

		$('#dataRow').show();


		// SHOW TOP PANELS
		// -------------------------------------

		toggle_TopBox("TM-st-avgsent-cont","show");
		toggle_TopBox("TM-st-topusers-cont","show");
		$('#TM-st-topusers').addClass('topImageFix');
		$('#generalSentiment').addClass('topImageFix');
		toggle_TopBox("TM-st-toplangs-cont","show");
		toggle_TopBox("TM-st-tophasht-cont","show");


		// PAINT TWEETS CIRCULAR CHART
		// -------------------------------------

		$.plot($("#flot-placeholder2"), dataSet, optionsTNumber);



		// GENERATE STATISTICS
		// -------------------------------------

		retrieveDataForStatistics(); // ()----->

	}



   /* ---------------------------------------------------------------------
   //
   // UI MANAGEMENT --- TWEETS TABS ---
   //
   // -------------------------------------------------------------------- */

	function openTab(tab,tabName,tweetID) {
	  var i;
	  var x = document.getElementsByClassName(tweetID);
	  for (i = 0; i < x.length; i++) {
	    x[i].style.display = "none";
	  }
	  document.getElementById(tabName).style.display = "block";  

          $("#tabT-"+tweetID).removeClass('active-tab');
          $("#tabD-"+tweetID).removeClass('active-tab');
          $("#tabA-"+tweetID).removeClass('active-tab');
          $(tab).addClass('active-tab');
	}



// ================================================================================
// ============================                 ===================================
// ============================      I/0        ===================================
// ============================   OPERATIONS    ===================================
// ============================                 ===================================
// ================================================================================

	/* ---------------------------------------------------------------------
	//
	// RETRIEVE ALL TWITTER SEARCHES
	//
	// -------------------------------------------------------------------- */

	function retrieveSearches(){

		$("#providerList").empty();

		//dataSet = [];
		dataSet.length = 0;
		searchListSet.length = 0;

		incrColourMin = 0;
		incrColourMax = 0.05;

		$.get("{{ url_for('TwitterMon.get_list_of_searches') }}",function(data) {
			
			numSearches = 0;

			for(i=0; i<data.length; i++){

				tweetSearch = data[i].split(";");

				// STORE SEARCH
				// -------------------------------------

				numSearches +=1;
				searchListSet.push(tweetSearch[0]);


				// CREATE DATA STRUCTURE
				// -------------------------------------

				tweetSearchLine = "<p style='padding-left:9px'><label class='provider'>";
				tweetSearchLine += "<i class='fa fa-search' style='color:#add0fd' onclick='retrieveTwSearchData(this.id)' id='" + tweetSearch[0] + "'></i>    ";
				tweetSearchLine += "<i class='fa fa-trash' style='color:#e3c9c9' onclick='deleteTwitterSearchName(this.id)' id='"+tweetSearch[0]+"'></i>    ";
				tweetSearchLine += "&nbsp;<strong>"+tweetSearch[0].toUpperCase()+"</strong> Tweets period: ("+tweetSearch[4].substring(0,10)+" - "+tweetSearch[5].substring(0,10)+"):<br/>";
				//tweetSearchLine += "   "+tweetSearch[4].substring(0,10)+" - " +tweetSearch[5].substring(0,10) + ": ";
				tweetSearchLine += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>" + tweetSearch[1] + "</b> tweets, ";
				tweetSearchLine += "<b>" +tweetSearch[2] + "</b> favorites, ";
				tweetSearchLine += "<b>" + tweetSearch[6] + "</b> retweets, ";

				if (tweetSearch[7] == ""){
					hashTagsSumm = "0";
				}else{
					hashTagsSumm = tweetSearch[7].split('|-|').length;
				}
				tweetSearchLine += "<b>" + hashTagsSumm + "</b> hashtags, ";
				tweetSearchLine += "  sentiment: ("+tweetSearch[3]+")" + getEmojiForScore(tweetSearch[3]) + "";				


				tweetSearchLine += "</label></p>";

				$("#providerList").append(tweetSearchLine);

				// ADD DATA TO TWEETS CIRCULAR CHART
				// -------------------------------------

				dataC = {};
				dataC['label'] = tweetSearch[0];
				dataC['data'] = parseInt(tweetSearch[1]);
				dataC['color'] = getRandomColor();
				dataSet.push(dataC);

 			}

			// PREPARE UI BASED ON DATA EXISTENCE
			// -------------------------------------

			if (numSearches == 0){

				setUIForNoData(); // ()-------->

			}else{

				setUIForData(); // ()-------->		
			}

		});

	}


	/* ---------------------------------------------------------------------
	//
	// RETRIEVE GENERAL DATA OF SELECTED TWITTER SEARCHES
	//
	// -------------------------------------------------------------------- */

	lastCardN = 0;

	function retrieveTwSearchData(searchname){

		$("#dataRow").empty();

		currentSearchDisplayed = searchname
		
		// GET TWITTER SEARCH GENERAL DATA
		// -------------------------------------

		$.get("{{ url_for('TwitterMon.get_twitter_search_general_data') }}",{searchname}, function(data){

			twitterSearchGenData = "<div class='col-lg-6'>";

			twitterSearchGenData += "<p><h5 class='card-title'> <b style='color:#343a40'>SEARCH:</b> " + data.search + "</h5></p>";

			// TIME PERIOD
			// ----------------
			twitterSearchGenData += "<p style='margin-bottom:2px'><b>Time frame:</b> " + data.minDate + " - "+ data.maxDate +"</p>";


			// NUMBER OF TWEETS
			// ----------------
			twitterSearchGenData += "<p style='margin-bottom:2px'><b>Tweets:</b> " + data.tweets + "</p>";

			// FAVORITES & RETWEETS
			// --------------------
			twitterSearchGenData += "<p style='margin-bottom:2px'><b>Favorites:</b> " + data.favorites + "</p>";
			twitterSearchGenData += "<p style='margin-bottom:2px'><b>Retweets:</b> " + data.retweets + "</p>";

			// SENTIMENT COMPOUND
			// --------------------

			twitterSearchGenData += "<p><b>Avg Sentiment:</b>" + getEmojiForScore(data.compound) + data.compound + "</p>";

			// USERS
			// --------------------
			twitterSearchGenData += "<p><b>Users:</b></p>";
				
			var arUsers = data.users.split(';');
			arrUsersSorted = sortTweetArray(arUsers);
			twitterSearchGenData += "<div style='height:200px;width:100%;border:solid 2px orange;overflow:scroll;overflow-x:hidden;overflow-y:scroll;background:white'>";

			twitterSearchGenData += "<ul id='usersList'>";
			
			for (iUsr = 0; iUsr<arrUsersSorted.length; iUsr++){
				twitterSearchGenData += "<li><a href='https://twitter.com/"+ extractName(arrUsersSorted[iUsr]) +"'>" + extractName(arrUsersSorted[iUsr]) + "</a>  (x" + extractNumber(arrUsersSorted[iUsr])+").</li>";
			}
			twitterSearchGenData += "</ul></div>";

			// LANGUAGES
			// --------------------

			twitterSearchGenData += "<p><b>Languages:</b></p>";

			var arLanguages = data.language.split(';');
			arLangSorted = sortTweetArray(arLanguages);
			twitterSearchGenData += "<div style='height:100px;width:100%;border:solid 2px orange;overflow:scroll;overflow-x:hidden;overflow-y:scroll;background:white'>";
			twitterSearchGenData += "<ul>";
			for (iL = 0; iL<arLangSorted.length; iL++){
					twitterSearchGenData += "<li>" + arLangSorted[iL] + "</li>";
			}
			twitterSearchGenData += "</ul></div>";
			

			// HASHTAGS
			// --------------------
			twitterSearchGenData += "<p><b>Hashtags:</b></p>";
				
			var arHashtags = data.hashtags.split(';');
			arHashTSorted = sortTweetArray(arHashtags);
			twitterSearchGenData += "<div style='height:200px;width:100%;border:solid 2px orange;overflow:scroll;overflow-x:hidden;overflow-y:scroll;background:white'>";
			twitterSearchGenData += "<ul>";
			for (iH = 0; iH<arHashTSorted.length; iH++){
				cleanHash = extractName(arHashTSorted[iH]);
				twitterSearchGenData += "<li><a href='https://twitter.com/hashtag/"+ cleanHash.substring(1,cleanHash.length) +"'>" + cleanHash + "</a>   (x"+ extractNumber(arHashTSorted[iH])+").</li>";
			}

			twitterSearchGenData += "</ul></div>";


			// MENTIONS
			// --------------------

			twitterSearchGenData += "<p><b>Mentions:</b></p>";

			var arMentions = data.mentions.split(';');
			arMentionsSorted = sortTweetArray(arMentions);
			twitterSearchGenData += "<div style='height:150px;width:100%;border:solid 2px orange;overflow:scroll;overflow-x:hidden;overflow-y:scroll;background:white'>";
			twitterSearchGenData += "<ul>";
			for (iH = 0; iH<arMentionsSorted.length; iH++){
				cleanUserT = extractName(arMentionsSorted[iH]);
				twitterSearchGenData += "<li><a href='https://twitter.com/"+ cleanUserT.substring(1,cleanUserT.length) +"'>" + cleanUserT + "</a>  (x" + extractNumber(arMentionsSorted[iH])+").</li>";
			}
			twitterSearchGenData += "</ul></div>";

			
			// EMOJIS
			// --------------------
			twitterSearchGenData += "<p><b>Emojis:</b></p>";

			var arEmojis = data.emojis.split(';');
			arEmojisSorted = sortTweetArray(arEmojis);
			twitterSearchGenData += "<div style='height:200px;width:100%;border:solid 2px orange;overflow:scroll;overflow-x:hidden;overflow-y:scroll;background:white'>";
			twitterSearchGenData += "<ul>";
			for (iH = 0; iH<arEmojisSorted.length; iH++){
				//console.log(arEmojisSorted[iH].substring(0,2));
				if (arEmojisSorted[iH].substring(0,2) != "\"\"") twitterSearchGenData += "<li>" + arEmojisSorted[iH] + "</li>";
			}
			twitterSearchGenData += "</ul></div>";
			
			twitterSearchGenData += "</div>";
			//twitterSearchGenData += "</div>";

			$("#dataRow").addClass("panelInf");
			$("#dataRow").append(twitterSearchGenData);
		});



		// GET TWEETS
		// -------------------------------------

		$.get("{{ url_for('TwitterMon.get_tweets_from_twitter_search') }}",{searchname}, function(data){

			tweetList = "<div class='col-lg-6'>";
			tweetList += "<input id='TM-filterTweets' class='form-control' placeholder='Filter Tweets' type='text' style='max-width:80%;display:inline' onkeydown='filterTweets(this)'>";
			tweetList += "<i class='fa fa-tags' style='color:"+tweetTaggedOff+";display:inline-block;border-radius:60px;box-shadow:0px 0px 2px 2px #888;padding: 0.5em 0.6em;margin-left:9px' onclick='filterTaggedTweets()' id='tagsFilter' tagged='false'></i>";
			tweetList += "<div id='TweetsContainer'>";
			
			jsonData = JSON.parse(data);

			for (j=0; j<jsonData.length; j++){

				// Username and Date
				// ----------------

				tweetList += "<div class='connect-cat' style='border:2px;border-style:groove;margin:12px;border-radius:4px'>";
				tweetList += "<div>";
				tweetList += "<h5 class='card-title'>";
				tweetList += "<img src='https://twitter.com/"+jsonData[j].user+"/profile_image?size=original' class='img-circle2'>";
				tweetList += "<b>" + jsonData[j].user + "</b> " + jsonData[j].tweetDate;
				//tweetList += "<i class='fa fa-trash' onclick='delete' id='"+jsonData[j].user+"'></i>";

				// Tagged status
				// ----------------

				if (jsonData[j].tagged == true){
					tagColor = tweetTaggedOn;
					tagStatus = "true";
				}else{
					tagColor = tweetTaggedOff;
					tagStatus = "false";
				}
				tweetList += "<i class='fa fa-tag' style='color:"+tagColor+"' onclick='tagTweet(this.id)' id='Tag-"+jsonData[j].tweetID+"' tagged='"+tagStatus+"' search='"+searchname+"'></i>";
				tweetList += "</h5>";
				tweetList += "</div>";


				tweetList += "<div>";
				tweetList += "<label class='tabs activeTab' id='tabT-"+jsonData[j].tweetID+"' onclick='openTab(this,\"Tweet-"+jsonData[j].tweetID+"\",\""+jsonData[j].tweetID+"\")'>Tweet</label>";
				tweetList += "<label class='tabs' id='tabA-"+jsonData[j].tweetID+"' onclick='openTab(this,\"Analysis-"+jsonData[j].tweetID+"\",\""+jsonData[j].tweetID+"\")'>Analysis "+ getEmojiForScore(jsonData[j].compound)+" </label>";
				tweetList += "<label class='tabs' id='tabD-"+jsonData[j].tweetID+"' onclick='openTab(this,\"Data-"+jsonData[j].tweetID+"\",\""+jsonData[j].tweetID+"\")'>Data</label>";
				tweetList += "</div>";
				
				// Tweet Tab:
				// -------------------------------
				tweetList += "<div id='Tweet-"+jsonData[j].tweetID+"' class='"+jsonData[j].tweetID+"' style='display:visible'>";
				tweetList += "<div class='tweet' style='padding:14px' id='" + jsonData[j].tweetID +"'></div>";
				tweetList += "</div>"; //Tweet-tab

				// Analysis Tab: Sentiment summary
				// -------------------------------
				tweetList += "<div id='Analysis-"+jsonData[j].tweetID+"' class='"+jsonData[j].tweetID+"' style='display:none'>";
  				tweetList += "<ul>";
				tweetList += "<li>Neutral: " + (jsonData[j].neu).toFixed(3) + "</li>";
				tweetList += "<li>Negative: " + (jsonData[j].neg).toFixed(3) + "</li>";
				tweetList += "<li>Positive: " + (jsonData[j].pos).toFixed(3) + "</li>";
				tweetList += "<li>Compound Positive: " + (jsonData[j].compoundPos).toFixed(3) + "</li>";
				tweetList += "<li>Compound Negative: " + (jsonData[j].compoundNeg).toFixed(3) + "</li>";
				tweetList += "<li>Compound: " + (jsonData[j].compound).toFixed(3) + " " +getEmojiForScore(jsonData[j].compound) + "</li>";
  				tweetList += "</ul>";
				tweetList += "</div>"; //Analysis-div

				// Data Tab
				// -------------------------------
				tweetList += "<div id='Data-"+jsonData[j].tweetID+"' class='"+jsonData[j].tweetID+"' style='display:none'>";
				tweetList += "<p><i class='fa fa-map'></i>Raw Text:</p>";
				tweetList += "<p class='twtText' style='padding-left:14px'>" + jsonData[j].tweet + "</p>";
				tweetList += "<p><i class='fa fa-flag'></i>Translation:</p>";
				tweetList += "<p>"+jsonData[j].tweetTrans+"</p>";
				tweetList += "</div>"; //Data-div

				tweetList += "</div>";//connect-cat

               		}
			tweetList += "</div>"; //TweetsContainer
			tweetList += "</div>"; //col-lg-6
			$("#dataRow").append(tweetList);

			loadTweets(searchname);	
		});
	}


	/* ---------------------------------------------------------------------
	//
	// DELETE SELECTED SEARCHES FROM DB
	//
	// -------------------------------------------------------------------- */

	function deleteTwitterSearchName(searchname){

		if (confirm('Are you sure?') == false) return;
    		$.get("{{ url_for('TwitterMon.delete_twitter_search_data') }}",{searchname}, function(data){
			retrieveSearches();
		});
	}


	/* ---------------------------------------------------------------------
	//
	// DELETE SPECIFIC TWEET FROM SEARCH
	//
	// -------------------------------------------------------------------- */

	function deleteTweetFromSearch(searchname){

		if (confirm('Are you sure?') == false) return;
    		$.get("{{ url_for('TwitterMon.delete_twitter_search_data') }}",{searchname}, function(data){
			retrieveSearches();
		});
	}


	/* ---------------------------------------------------------------------
	//
	// TAG TWEET
	//
	// -------------------------------------------------------------------- */

	function tagTweet(tweetTag){

		searchname = document.getElementById(tweetTag).getAttribute('search')
		
		if (document.getElementById(tweetTag).getAttribute('tagged') == "true"){
			currValue = 1;
		}else{
			currValue = 0;
		}

    		$.get("{{ url_for('TwitterMon.changeTweetTag') }}",{searchname,tweetTag,currValue}, function(data){

			if (data=="Success"){
				if (document.getElementById(tweetTag).getAttribute('tagged') == "true"){
					document.getElementById(tweetTag).style.color = tweetTaggedOff;
					document.getElementById(tweetTag).setAttribute('tagged',"false");
				}else{
					document.getElementById(tweetTag).style.color = tweetTaggedOn;
					document.getElementById(tweetTag).setAttribute('tagged',"true");
				}
			}
		});
	}

</script>
</body>
</html>
